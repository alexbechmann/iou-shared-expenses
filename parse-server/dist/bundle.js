!function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r.w={},r(r.s=13)}([function(e,t){e.exports=require("@iou/core")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createUserPointer=function(e){return{__type:"Pointer",className:"_User",objectId:e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(10);t.FriendRequest=n.FriendRequest;var s=r(9);t.Transaction=s.Transaction},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(s,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?s(e.value):new r(function(t){t(e.value)}).then(o,c)}u((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=r(2),i=r(1),o=r(0);t.TransactionService=class{allTransactionsBetweenUsers(e,t){return n(this,void 0,void 0,function*(){const r=new Parse.Query(s.Transaction);r.equalTo(o.nameof("fromUser"),i.createUserPointer(e)),r.equalTo(o.nameof("toUser"),i.createUserPointer(t));const n=new Parse.Query(s.Transaction);return n.equalTo(o.nameof("toUser"),i.createUserPointer(e)),n.equalTo(o.nameof("fromUser"),i.createUserPointer(t)),yield Parse.Query.or(r,n).limit(9999999999).find()})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);t.CurrencyService=class{getAllCurrenyTypes(){return Object.keys(n.CurrencyType).map(e=>n.CurrencyType[e])}getAllCurrencies(){return this.getAllCurrenyTypes().map(e=>({name:n.CurrencyType[e],id:e}))}}},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(s,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?s(e.value):new r(function(t){t(e.value)}).then(o,c)}u((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=r(4),i=r(3);t.SettlementService=class{constructor(){this.currencyService=new s.CurrencyService,this.transactionService=new i.TransactionService}getSettlementsBetween(e,t){return n(this,void 0,void 0,function*(){const r=yield this.transactionService.allTransactionsBetweenUsers(e,t);var n=[];for(let s of this.currencyService.getAllCurrencies()){const i=r.filter(e=>e.currencyId===s.id);if(i.length>0){const r={fromUserId:e,toUserId:t,currency:s,amount:0};for(let e of i)r.amount+=e.amount;n.push(r)}}return n})}}},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(s,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?s(e.value):new r(function(t){t(e.value)}).then(o,c)}u((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=r(5);t.getSettlementsBetweenUsers=function(e,t){return n(this,void 0,void 0,function*(){const r=e.params,n=yield(new s.SettlementService).getSettlementsBetween(e.user.id,r.toUserId);t.success(n)})}},function(e,t){e.exports=require("parse")},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(s,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?s(e.value):new r(function(t){t(e.value)}).then(o,c)}u((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=r(7),i=r(0);t.UserService=class{userForId(e){return n(this,void 0,void 0,function*(){return yield new Parse.Query(s.User).get(e)})}userForFacebookId(e){return n(this,void 0,void 0,function*(){const t=new Parse.Query(s.User);return t.equalTo(i.nameof("facebookId"),e),yield t.first()})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Transaction=class extends Parse.Object{constructor(){super("Transaction")}get fromUser(){return this.get("fromUser")}set fromUser(e){this.set("fromUser",e)}get toUser(){return this.get("toUser")}set toUser(e){this.set("toUser",e)}get isSecure(){return this.get("isSecure")}set isSecure(e){this.set("isSecure",e)}get currencyId(){return this.get("currencyId")}set currencyId(e){this.set("currencyId",e)}get transactionDate(){return this.get("transactionDate")}set transactionDate(e){this.set("transactionDate",e)}get purchaseTransactionLinkUUID(){return this.get("purchaseTransactionLinkUUID")}set purchaseTransactionLinkUUID(e){this.set("purchaseTransactionLinkUUID",e)}get amount(){return this.get("amount")}set amount(e){this.set("amount",e)}get title(){return this.get("title")}set title(e){this.set("title",e)}get transactionType(){return this.get("transactionType")}set transactionType(e){this.set("transactionType",e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FriendRequest=class extends Parse.Object{constructor(){super("FriendRequest")}get fromUser(){return this.get("fromUser")}set fromUser(e){this.set("fromUser",e)}get toUser(){return this.get("toUser")}set toUser(e){this.set("toUser",e)}}},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(s,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?s(e.value):new r(function(t){t(e.value)}).then(o,c)}u((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=r(1),i=r(2);t.SocialService=class{insertFriendRequestIfNeeded(e,t){return n(this,void 0,void 0,function*(){const r=s.createUserPointer(e),n=s.createUserPointer(t);if(!1===(yield this.friendRequestExists(r,n))){var o=new i.FriendRequest;o.fromUser=r,o.toUser=n,yield o.save()}})}friendRequestExists(e,t){return n(this,void 0,void 0,function*(){return(yield this.friendRequestsBetweenQuery(e,t).count())>0})}friendRequestsBetween(e,t){return n(this,void 0,void 0,function*(){return console.log(e,t),yield this.friendRequestsBetweenQuery(e,t).find()})}friendRequestsBetweenQuery(e,t){const r=new Parse.Query(i.FriendRequest);return r.equalTo("fromUser",e),r.include("fromUser"),r.include("toUser"),r.equalTo("toUser",t),console.log(r),r}getFriendsForUser(e){return n(this,void 0,void 0,function*(){return yield e.relation("friends").query().find()})}}},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(s,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?s(e.value):new r(function(t){t(e.value)}).then(o,c)}u((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=r(11),i=r(8),o=r(1);t.sendFriendRequest=function(e,t){const r=e.params;(new s.SocialService).insertFriendRequestIfNeeded(e.user.id,r.toUserId).then(()=>{t.success({})},e=>{t.error(e)})},t.acceptFriendRequest=function(e,t){return n(this,void 0,void 0,function*(){const r=e.params,n=e.user,c=new s.SocialService,u=new i.UserService,a=yield u.userForId(n.id),d=yield u.userForId(r.toUserId);a.relation("friends").add(d),d.relation("friends").add(a),yield Parse.Object.saveAll([a,d],{useMasterKey:!0});var f=yield c.friendRequestsBetween(o.createUserPointer(n.id),o.createUserPointer(r.toUserId)),l=yield c.friendRequestsBetween(o.createUserPointer(r.toUserId),o.createUserPointer(n.id));const y=Array.prototype.concat(f,l);for(let e of y)yield e.destroy();return t.success({})})},t.findFriendsWithFacebookIds=function(e,t){return n(this,void 0,void 0,function*(){const r=e.params,n=new i.UserService;var s=0;if(e.user instanceof Parse.User)for(let t of r.facebookIds){const r=yield n.userForFacebookId(t);r instanceof Parse.User&&(e.user.relation("friends").add(r),s++)}return s>0&&(yield Parse.Object.saveAll([e.user],{useMasterKey:!0})),t.success({found:s})})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),s=r(12),i=r(6);Parse.Cloud.define(n.CLOUD_FUNCTION_SEND_FRIEND_REQUEST,s.sendFriendRequest),Parse.Cloud.define(n.CLOUD_FUNCTION_ACCEPT_FRIEND_REQUEST,s.acceptFriendRequest),Parse.Cloud.define(n.CLOUD_FUNCTION_GET_SETTLEMENTS_BETWEEN_USERS,i.getSettlementsBetweenUsers),Parse.Cloud.define(n.CLOUD_FUNCTION_FIND_FRIENDS_WITH_FACEBOOK_IDS,s.findFriendsWithFacebookIds)}]);